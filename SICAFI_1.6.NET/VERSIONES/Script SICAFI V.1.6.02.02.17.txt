USE [SICAFI]
GO
/****** Objeto:  Table [dbo].[MUTAMATR]    Fecha de la secuencia de comandos: 02/09/2017 14:06:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[MUTAMATR](
	[MUMAIDRE] [int] IDENTITY(1,1) NOT NULL,
	[MUMASECU] [int] NOT NULL,
	[MUMANUFI] [int] NOT NULL,
	[MUMAMAIN] [int] NOT NULL,
	[MUMAVACO] [bigint] NOT NULL,
 CONSTRAINT [PK_MUTAMATR] PRIMARY KEY CLUSTERED 
(
	[MUMASECU] ASC,
	[MUMANUFI] ASC,
	[MUMAMAIN] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

GO
USE [SICAFI]
GO
ALTER TABLE [dbo].[MUTAMATR]  WITH CHECK ADD  CONSTRAINT [FK_MUTAMATR_MUTACIONES] FOREIGN KEY([MUMASECU])
REFERENCES [dbo].[MUTACIONES] ([MUTASECU])
ON UPDATE CASCADE
ON DELETE CASCADE

----------------------------------------------------

insert into PERMSUFO (PESFUSUA,PESFFORM,PESFDESC,PESFAGRE,PESFMODI,PESFELIM,PESFESTA) values
	(
	'ADMINISTRADOR',
	'BindingNavigator_MUTAMATR_1',
	'Menu Mutaciones - Matriculas anexas',
    '1',
    '1',
    '1',
    'ac' 
	)
	
----------------------------------------------------

USE [SICAFI]
GO
/****** Objeto:  Table [dbo].[RESOADMI]    Fecha de la secuencia de comandos: 02/15/2017 17:24:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[RESOADMI](
	[READIDRE] [int] IDENTITY(1,1) NOT NULL,
	[READCLAS] [int] NOT NULL,
	[READNURE] [int] NOT NULL,
	[READFERE] [char](10) COLLATE Modern_Spanish_CI_AS NOT NULL,
	[READTIRE] [int] NOT NULL,
	[READCLSE] [int] NOT NULL,
	[READVIRE] [int] NOT NULL,
	[READESTA] [char](10) COLLATE Modern_Spanish_CI_AS NOT NULL,
 CONSTRAINT [PK_RESOADMI] PRIMARY KEY CLUSTERED 
(
	[READNURE] ASC,
	[READFERE] ASC
)WITH (IGNORE_DUP_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]

GO
SET ANSI_PADDING OFF
GO
USE [SICAFI]
GO
ALTER TABLE [dbo].[RESOADMI]  WITH CHECK ADD  CONSTRAINT [FK_RESOADMI_ESTADO] FOREIGN KEY([READESTA])
REFERENCES [dbo].[ESTADO] ([ESTACODI])
GO
ALTER TABLE [dbo].[RESOADMI]  WITH CHECK ADD  CONSTRAINT [FK_RESOADMI_MANT_CLASIFICACION] FOREIGN KEY([READCLAS])
REFERENCES [dbo].[MANT_CLASIFICACION] ([CLASCODI])
GO
ALTER TABLE [dbo].[RESOADMI]  WITH CHECK ADD  CONSTRAINT [FK_RESOADMI_MANT_CLASSECT] FOREIGN KEY([READCLSE])
REFERENCES [dbo].[MANT_CLASSECT] ([CLSECODI])
GO
ALTER TABLE [dbo].[RESOADMI]  WITH CHECK ADD  CONSTRAINT [FK_RESOADMI_MANT_TIPORESO] FOREIGN KEY([READTIRE])
REFERENCES [dbo].[MANT_TIPORESO] ([TIRECODI])
GO
ALTER TABLE [dbo].[RESOADMI]  WITH CHECK ADD  CONSTRAINT [FK_RESOADMI_VIGENCIA] FOREIGN KEY([READVIRE])
REFERENCES [dbo].[VIGENCIA] ([VIGECODI])

-------------------------------------------------------

insert into PERMETIQ (PEETUSUA,PEETETIQ,PEETDESC,PEETESTA) values
	(
	'ADMINISTRADOR',
	'ResolucionAdministrativaToolStripMenuItem',
	'Resolucion Administrativa',
    'ac' 
	)
	
insert into PERMFORM (PEFOUSUA,PEFOFORM,PEFODESC,PEFOAGRE,PEFOMODI,PEFOELIM,PEFOESTA) values
	(
	'ADMINISTRADOR',
	'frm_RESOADMI',
	'Resolucion Administrativa',
    '1', 
    '1',
    '1',
    'ac' 
	)
        
-------------------------------------------------------

CREATE PROCEDURE [dbo].[Consultar_NRO_REGISTROS_DE_EXPORTACION_RESOADMI]

@RESOTIRE  int,
@RESOCLSE  int,
@RESOVIGE  int,
@RESORESO  int


AS
-- 0 --
SELECT COUNT(1) FROM FICHPRED WHERE FIPRRESO = @RESORESO AND
                                    FIPRTIRE = @RESOTIRE AND
                                    FIPRVIGE = @RESOVIGE AND
									FIPRCLSE = @RESOCLSE AND 
                                    FIPRESTA = 'ac' AND
									FIPRTIFI = 0 
-- 1 --
SELECT COUNT(1) FROM FIPRDEEC,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPDENUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPDEESTA = 'ac' AND 
                                             FIPRTIFI = 0 
-- 2 --
SELECT COUNT(1) FROM FIPRPROP,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPPRNUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPPRESTA = 'ac' AND 
                                             FIPRTIFI = 0  
-- 3 --
SELECT COUNT(1) FROM FIPRCONS,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPCONUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPCOESTA = 'ac' AND 
                                             FIPRTIFI = 0  
-- 4 --
SELECT COUNT(1) FROM FIPRCACO,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPCCNUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPCCESTA = 'ac' AND 
                                             FIPRTIFI = 0  
-- 5 --
SELECT COUNT(1) FROM FIPRLIND,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND
                                             FIPRNUFI = FPLINUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPLIESTA = 'ac' AND 
                                             FIPRTIFI = 0  
-- 6 --
SELECT COUNT(1) FROM FIPRCART,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPCANUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPCAESTA = 'ac' AND 
                                             FIPRTIFI = 0 

---------------------------------------------------------


CREATE PROCEDURE [dbo].[Consultar_NRO_REGISTROS_DE_EXPORTACION_FICHA_RESUMEN_RESOADMI]

@RESOTIRE  int,
@RESOCLSE  int,
@RESOVIGE  int,
@RESORESO  int


AS

-- 0 --
SELECT COUNT(1) FROM FICHPRED WHERE FIPRRESO = @RESORESO AND
                                    FIPRTIRE = @RESOTIRE AND
                                    FIPRVIGE = @RESOVIGE AND
									FIPRCLSE = @RESOCLSE AND 
                                    FIPRESTA = 'ac' AND
									FIPRTIFI IN ('1','2')
-- 1 --
SELECT COUNT(1) FROM FIPRDEEC,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPDENUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPDEESTA = 'ac' AND 
                                             FIPRTIFI IN ('1','2')
-- 2 --
SELECT COUNT(1) FROM FIPRPROP,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPPRNUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPPRESTA = 'ac' AND 
                                             FIPRTIFI IN ('1','2')
-- 3 --
SELECT COUNT(1) FROM FIPRCONS,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPCONUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPCOESTA = 'ac' AND 
                                             FIPRTIFI IN ('1','2') 
-- 4 --
SELECT COUNT(1) FROM FIPRCACO,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPCCNUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPCCESTA = 'ac' AND 
                                             FIPRTIFI IN ('1','2')
-- 5 --
SELECT COUNT(1) FROM FIPRLIND,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPLINUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPLIESTA = 'ac' AND 
                                             FIPRTIFI IN ('1','2')
-- 6 --
SELECT COUNT(1) FROM FIPRCART,FICHPRED WHERE FIPRRESO = @RESORESO AND
                                             FIPRTIRE = @RESOTIRE AND
                                             FIPRVIGE = @RESOVIGE AND
									         FIPRCLSE = @RESOCLSE AND 
                                             FIPRNUFI = FPCANUFI AND 
                                             FIPRESTA = 'ac' AND 
                                             FPCAESTA = 'ac' AND 
                                             FIPRTIFI IN ('1','2')


---------------------------------------------------------


insert into PERMSUFO (PESFUSUA,PESFFORM,PESFDESC,PESFAGRE,PESFMODI,PESFELIM,PESFESTA) values
	(
	'ADMINISTRADOR',
	'BindingNavigator_OBURREPO_1',
	'Obligación Urbaniastica - Reportes',
    '1', 
    '1',
    '1',
    'ac' 
	)
        
---------------------------------------------------------

ALTER TABLE OBURPRED ADD OUPRFUAN BIT NULL DEFAULT 0

UPDATE OBURPRED SET OUPRFUAN = 0

---------------------------------------------------------